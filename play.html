---
layout: null
permalink: /play/
---
<!DOCTYPE html>
<html lang="ko">
<head>
    <link rel="manifest" href="{{ '/manifest.json' | relative_url }}">
<meta name="theme-color" content="#E87A90">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Library</title>
    <link rel="stylesheet" href="{{ '/assets/css/play-style.css' | relative_url }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <link rel="icon" type="image/x-icon" href="{{ '/assets/img/favicon_s.ico' | relative_url }}">
</head>
<body class="play-mode">

    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
    <div class="play-sidebar" id="sidebar">
        <div class="sidebar-profile">
            <div class="profile-img"><i class="fas fa-user"></i></div>
            <div class="profile-name">
                <span id="user-name-display">ê²ŒìŠ¤íŠ¸</span>ë‹˜ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬
                <i class="fas fa-pen" onclick="editProfile()" style="font-size:0.8rem; margin-left:5px; cursor:pointer; opacity:0.7;"></i>
            </div>
            <div class="profile-desc">Backstage ğŸŒ¸</div>
        </div>
        
        <div class="sidebar-menu">
            <div class="sidebar-item" onclick="showGlobalAll()">
                <i class="fas fa-layer-group"></i> ëª¨ë“  ì‘í’ˆ ë³´ê¸° (ì „ì²´)
            </div>
            <div class="sidebar-item" onclick="resetSeriesFilter()">
                <i class="fas fa-undo"></i> í˜„ì¬ ì‹œë¦¬ì¦ˆ ë‹¤ì‹œ ë³´ê¸°
            </div>

            <div class="sidebar-item" onclick="filterList('liked')">
                <i class="fas fa-heart"></i> ì°œí•œ ì‘í’ˆ ëª¨ì•„ë³´ê¸°
            </div>
            <div class="sidebar-divider"></div>
            <div class="sidebar-item" onclick="location.href='https://narelim.github.io/mag-ross-archive/secret/'">
                <i class="fas fa-home"></i> ì‹œí¬ë¦¿ ë©”ì¸ìœ¼ë¡œ
            </div>
            <div class="sidebar-item" onclick="toggleSidebar()">
                <i class="fas fa-times"></i> ë©”ë‰´ ë‹«ê¸°
            </div>
        </div>
    </div>

    <header class="play-header">
        <div class="play-title">
            <i class="fas fa-bars play-icon-menu" onclick="toggleSidebar()"></i> 
            <span id="header-title">ë¼ì´ë¸ŒëŸ¬ë¦¬</span>
        </div>
        <div>
            <i class="fas fa-search play-icon-menu" style="margin-right:15px;"></i>
            <i id="install-btn" class="fas fa-download"></i>
        </div>
    </header>

    <div class="play-filter-bar">
        <div class="play-chip active" id="chip-all" onclick="filterList('all')">ëª¨ë‘</div>
        <div class="play-chip" id="chip-liked" onclick="filterList('liked')">ì°œí•œ ì‘í’ˆ</div>
    </div>

    <div class="play-container" id="play-list"></div>


<script>
    // --- 0. ì „ì—­ ë³€ìˆ˜ (ìƒíƒœ ê´€ë¦¬) ---
    // viewMode: 'series' (ê¸°ë³¸: íŠ¹ì • ì‹œë¦¬ì¦ˆë§Œ) / 'global' (ì „ì²´ ë‹¤ ë³´ê¸°)
    let viewMode = 'series'; 

    const urlParams = new URLSearchParams(window.location.search);
    const targetId = (urlParams.get('id') || "").trim(); 
    const listContainer = document.getElementById('play-list');
    const headerTitle = document.getElementById('header-title');


    // --- 1. ì‚¬ì´ë“œë°” & ë³´ê¸° ëª¨ë“œ ë³€ê²½ ê¸°ëŠ¥ ---
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.querySelector('.sidebar-overlay');
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
    }

    // [NEW] ëª¨ë“  ì‘í’ˆ ë‹¤ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
    function showGlobalAll() {
        viewMode = 'global'; // ëª¨ë“œ ë³€ê²½
        renderList('all');   // ë‹¤ì‹œ ê·¸ë¦¬ê¸°
        toggleSidebar();     // ì‚¬ì´ë“œë°” ë‹«ê¸°
        headerTitle.innerText = "ì „ì²´ ë³´ê´€í•¨ ğŸ“š"; // ì œëª© ë³€ê²½
    }

    // [NEW] ë‹¤ì‹œ ì›ë˜ ì‹œë¦¬ì¦ˆë§Œ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
    function resetSeriesFilter() {
        viewMode = 'series';
        renderList('all');
        toggleSidebar();
        headerTitle.innerText = "ë¼ì´ë¸ŒëŸ¬ë¦¬";
    }


    // --- 2. ë‹‰ë„¤ì„ ê´€ë¦¬ ---
    function loadUserName() {
        const savedName = localStorage.getItem('play_username') || 'ê²ŒìŠ¤íŠ¸';
        document.getElementById('user-name-display').innerText = savedName;
    }

    function editProfile() {
        const newName = prompt("ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì£¼ì¸ ì´ë¦„ì„ ì•Œë ¤ì£¼ì„¸ìš”!", "ì¬ì€");
        if (newName) {
            localStorage.setItem('play_username', newName);
            document.getElementById('user-name-display').innerText = newName;
            alert(newName + "ë‹˜ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸŒ¸");
        }
    }
    loadUserName();


    // --- 3. ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ---
    const allPosts = [
        {% for post in site.posts %}
            // ğŸš¨ ì˜¤íƒ€ ìˆ˜ì •ë¨: {if -> {% if
            // ğŸš¨ ìœ„ì¹˜ ìˆ˜ì •ë¨: ì¡°ê±´ë¬¸ ì•ˆìœ¼ë¡œ ê°ì²´ ì‹œì‘({)ì„ ë„£ì–´ì„œ ë¹ˆ ë°ì´í„° ë°©ì§€
            {% if post.url contains 'secret' or post.categories contains 'secret' %}
            {
                title: "{{ post.title | replace: '"', '\"' }}",
                url: "{{ post.url | relative_url }}",
                date: "{{ post.date | date: '%Y.%m.%d' }}",
                author: "{{ post.author | default: 'Unknown' }}",
                seriesId: "{{ post.series_id | strip }}", 
                tags: {{ post.tags | jsonify }}, 
                layout: "{{ post.layout | strip }}",
                {% if post.image %}
                    {% if post.image contains '/' %}
                        image: "{{ post.image | relative_url }}",
                    {% else %}
                        image: "{{ '/assets/img/' | append: post.image | relative_url }}",
                    {% endif %}
                {% else %}
                    image: "",
                {% endif %}
            },
            {% endif %}
        {% endfor %}
        
        {% for page in site.pages %}
            {% if page.series_id and page.url contains 'secret' %}
            {
                title: "{{ page.title | replace: '"', '\"' }}",
                url: "{{ page.url | relative_url }}",
                date: "{{ page.date | default: site.time | date: '%Y.%m.%d' }}",
                author: "{{ page.author | default: 'Unknown' }}",
                seriesId: "{{ page.series_id | strip }}", 
                tags: {{ page.tags | jsonify }}, 
                layout: "{{ page.layout | strip }}",
                {% if page.image %}
                    {% if page.image contains '/' %}
                        image: "{{ page.image | relative_url }}",
                    {% else %}
                        image: "{{ '/assets/img/' | append: page.image | relative_url }}",
                    {% endif %}
                {% else %}
                    image: "",
                {% endif %}
            },
            {% endif %}
        {% endfor %}
    ];


    // --- 4. ì°œí•˜ê¸° ê¸°ëŠ¥ ---
    function getLikedItems() {
        const stored = localStorage.getItem('my_liked_posts');
        return stored ? JSON.parse(stored) : [];
    }

    function toggleLike(url, btn) {
        event.preventDefault(); 
        event.stopPropagation();

        let likes = getLikedItems();
        if (likes.includes(url)) {
            likes = likes.filter(item => item !== url);
            btn.classList.remove('liked');
            btn.innerHTML = '<i class="far fa-heart"></i>';
        } else {
            likes.push(url);
            btn.classList.add('liked');
            btn.innerHTML = '<i class="fas fa-heart"></i>';
        }
        localStorage.setItem('my_liked_posts', JSON.stringify(likes));
        
        const currentFilter = document.getElementById('chip-liked').classList.contains('active') ? 'liked' : 'all';
        if(currentFilter === 'liked') {
            renderList('liked');
        }
    }


    // --- 5. ë¦¬ìŠ¤íŠ¸ ê·¸ë¦¬ê¸° ---
    function renderList(filterType) {
        listContainer.innerHTML = ''; 
        let count = 0;
        const myLikes = getLikedItems(); 

        document.getElementById('chip-all').classList.toggle('active', filterType === 'all');
        document.getElementById('chip-liked').classList.toggle('active', filterType === 'liked');

        allPosts.forEach(post => {
            // [ê²€ì‚¬ 1] ë ˆì´ì•„ì›ƒì´ 'product'(ë¶€ëª¨í˜ì´ì§€)ê°€ ì•„ë‹ ê²ƒ
            if (post.layout === 'product') return;

            // [ê²€ì‚¬ 2] ë³´ì—¬ì¤„ ì¡°ê±´ í™•ì¸
            let isTargetMatch = false;

            if (viewMode === 'global') {
                // ëª¨ë“œê°€ 'ì „ì²´(global)'ì´ë©´ ë¬´ì¡°ê±´ í†µê³¼!
                isTargetMatch = true; 
            } else {
                // ëª¨ë“œê°€ 'ì‹œë¦¬ì¦ˆ'ì´ë©´ IDê°€ ê°™ì•„ì•¼ í†µê³¼
                if (post.seriesId === targetId) isTargetMatch = true;
            }

            // ì¡°ê±´ ë¶ˆì¼ì¹˜ë©´ ê±´ë„ˆë›°ê¸°
            if (!isTargetMatch) return;


            // [ê²€ì‚¬ 3] ì°œ í•„í„° í™•ì¸
            if (filterType === 'liked') {
                if (!myLikes.includes(post.url)) return;
            }

            // --- í†µê³¼! ê·¸ë¦¬ê¸° ì‹œì‘ ---
            let thumbImg = post.image && post.image !== "" ? post.image : "https://via.placeholder.com/90x90?text=No+Img";
            let badgeHTML = post.tags && post.tags.length > 0 ? `<span class="play-badge">${post.tags[0]}</span>` : "";

            const isLiked = myLikes.includes(post.url);
            const heartClass = isLiked ? 'liked' : '';
            const heartIcon = isLiked ? 'fas fa-heart' : 'far fa-heart';

            const itemHTML = `
                <div class="play-item-wrapper" style="position:relative;">
                    <a href="${post.url}" class="play-item">
                        <div class="play-thumb">
                            <img src="${thumbImg}" alt="thumb">
                        </div>
                        <div class="play-info">
                            <div class="play-item-title">${post.title}</div>
                            <div class="play-item-meta">${post.author} Â· ${post.date}</div>
                            ${badgeHTML}
                        </div>
                    </a>
                    <div class="play-like-btn ${heartClass}" onclick="toggleLike('${post.url}', this)">
                        <i class="${heartIcon}"></i>
                    </div>
                </div>
            `;
            listContainer.innerHTML += itemHTML;
            count++;
        });

        if (count === 0) {
            let msg = filterType === 'liked' ? "ì°œí•œ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤." : "ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.";
            listContainer.innerHTML = `
                <div style="text-align:center; padding:50px; color:#888;">
                    <i class="far fa-folder-open" style="font-size:3rem; margin-bottom:10px;"></i><br>
                    ${msg}
                </div>`;
        }
    }

    function filterList(type) {
        renderList(type);
        if(document.getElementById('sidebar').classList.contains('active')) {
             toggleSidebar();
        }
    }

    // ì‹œì‘: ì „ì²´ ëª©ë¡ìœ¼ë¡œ
    renderList('all');

        // --- ğŸ“² (ì¶”ê°€ë¨) ì•± ì„¤ì¹˜ ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ ---
        
        let deferredPrompt; // ì•ˆë“œë¡œì´ë“œ ì„¤ì¹˜ íŒì—… ì €ì¥ìš©
        const installBtn = document.getElementById('install-btn');

        // 1. ì•ˆë“œë¡œì´ë“œ: ì„¤ì¹˜ ê°€ëŠ¥í•œ ìƒíƒœ ê°ì§€
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // ì„¤ì¹˜ ê°€ëŠ¥í•  ë•Œë§Œ ë²„íŠ¼ì´ ë°˜ì§ì´ê±°ë‚˜ ìƒ‰ì´ ì§„í•´ì§€ê²Œ í•  ìˆ˜ë„ ìˆìŒ (ì„ íƒì‚¬í•­)
            // ì—¬ê¸°ì„œëŠ” ì¼ë‹¨ ê¸°ëŠ¥ë§Œ ì—°ê²°í•©ë‹ˆë‹¤.
        });

        // 2. ë²„íŠ¼ í´ë¦­ ì‹œ ë™ì‘
        installBtn.addEventListener('click', () => {
            
            // (A) ì•ˆë“œë¡œì´ë“œ: ì§„ì§œ ì„¤ì¹˜ ì°½ ë„ìš°ê¸°
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('ì„¤ì¹˜ ì™„ë£Œ!');
                        installBtn.style.display = 'none'; // ì„¤ì¹˜í–ˆìœ¼ë©´ ìˆ¨ê¹€
                    }
                    deferredPrompt = null;
                });
            } 
            // (B) ì•„ì´í°/PC: ì¹œì ˆí•œ ì„¤ëª… ë„ìš°ê¸°
            else {
                const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
                if (isIOS) {
                    alert("ğŸ’Œ ì•„ì´í° ì„¤ì¹˜ íŒ\n\ní•˜ë‹¨ [ê³µìœ ] ë²„íŠ¼ -> [í™ˆ í™”ë©´ì— ì¶”ê°€ â•]\n\nì´ë ‡ê²Œ í•˜ë©´ ì§„ì§œ ì•±ì²˜ëŸ¼ ì „ì²´í™”ë©´ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆì–´ìš”! ğŸŒ¸");
                } else {
                    alert("ë¸Œë¼ìš°ì € ë©”ë‰´ì—ì„œ [ì•± ì„¤ì¹˜] ë˜ëŠ” [í™ˆ í™”ë©´ì— ì¶”ê°€]ë¥¼ ì°¾ì•„ë³´ì„¸ìš”!");
                }
            }
        });

</script>
</body>
</html>
